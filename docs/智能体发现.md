# A2A协议中的智能体发现

为了使用智能体间（A2A）协议进行协作，AI智能体首先需要找到彼此并理解对方的能力。A2A通过**智能体卡片**标准化了智能体的自描述。然而，发现这些卡片的方法因环境和需求而异。智能体卡片定义了智能体能提供什么。客户端智能体可以通过多种策略来发现这些卡片，策略的选择取决于部署环境和安全要求。

## 智能体卡片的作用

智能体卡片是一份JSON文档，作为A2A服务器（远程智能体）的**数字“名片”**。它对于智能体发现和交互至关重要。其包含的关键信息如下：

*   **身份信息**：包括名称、描述和提供商信息。
*   **服务端点**：指定A2A服务的`url`。
*   **A2A能力**：列出支持的功能，例如`streaming`或`pushNotifications`。
*   **认证**：详细说明所需的认证方案（如“Bearer”、“OAuth2”）。
*   **技能**：使用`AgentSkill`对象描述智能体的任务，包括`id`、`name`、`description`、`inputModes`、`outputModes`和`examples`。

客户端智能体利用智能体卡片来判断一个智能体是否适合、如何构建请求，并确保通信安全。

## 发现策略

以下部分详述了客户端智能体发现远程智能体卡片的常见策略：

### 1. 知名URI

此方法适用于**公共智能体**或在特定域内**希望被广泛发现**的智能体。

*   **机制**：A2A服务器通过在其域上的一个标准化、知名的URI地址托管其智能体卡片，使其可被发现。标准路径为 `https://{agent-server-domain}/.well-known/agent-card.json`，遵循[RFC 8615](https://www.rfc-editor.org/rfc/rfc8615)的原则。
*   **流程**：
    1.  客户端智能体知道或通过程序发现潜在A2A服务器的域名（例如，`smart-thermostat.example.com`）。
    2.  客户端向 `https://smart-thermostat.example.com/.well-known/agent-card.json` 发起HTTP GET请求。
    3.  如果智能体卡片存在且可访问，服务器将其作为JSON响应返回。
*   **优点**：
    *   易于实现。
    *   遵循标准。
    *   便于自动化发现。
*   **注意事项**：
    *   最适合开放或受控域内的发现场景。
    *   如果智能体卡片包含敏感细节，则托管该卡片的端点需要**认证**。

### 2. 策展注册中心（基于目录的发现）

此方法用于**企业环境**或**公共市场**，其中智能体卡片通常由一个中央注册中心管理。策展注册中心充当中央存储库，允许客户端根据“技能”或“标签”等条件查询和发现智能体。

*   **机制**：一个中介服务（注册中心）维护一个智能体卡片集合。客户端向此注册中心查询，以根据各种条件（如提供的技能、标签、提供商名称、能力）来寻找智能体。
*   **流程**：
    1.  A2A服务器将其智能体卡片发布到注册中心。
    2.  客户端智能体查询注册中心的API，并根据“特定技能”等条件进行搜索。
    3.  注册中心返回匹配的智能体卡片或引用。
*   **优点**：
    *   集中的管理和治理。
    *   基于能力的发现（例如，按技能）。
    *   支持访问控制和信任框架。
    *   适用于私有和公共市场。
*   **注意事项**：
    *   需要部署和维护注册中心服务。
    *   当前A2A规范并未规定策展注册中心的**标准API**。

### 3. 直接配置 / 私有发现

此方法用于**紧密耦合的系统**、**私有智能体**或**开发目的**，其中客户端直接通过智能体卡片信息或URL进行配置。

*   **机制**：客户端应用程序利用硬编码的详细信息、配置文件、环境变量或专有API进行发现。
*   **流程**：流程根据应用程序的部署和配置策略而不同。
*   **优点**：此方法对于在已知的、静态的关系中建立连接来说很简单直接。
*   **注意事项**：
    *   在动态发现场景中**不灵活**。
    *   智能体卡片信息的变更需要客户端**重新配置**。
    *   基于专有API的发现也**缺乏标准化**。

## 保护智能体卡片

智能体卡片包含敏感信息，例如：
*   内部或受限智能体的URL。
*   敏感技能的描述。

### 保护机制

为降低风险，应考虑以下保护机制：
*   **经过认证的智能体卡片**：我们建议对敏感信息或用于提供卡片更详细版本时，使用**经过认证的扩展智能体卡片**。
*   **安全端点**：在提供智能体卡片的HTTP端点（例如 `/.well-known/agent-card.json` 或注册中心API）上实施访问控制。方法包括：
    *   相互TLS（mTLS）
    *   网络限制（例如，IP范围）
    *   HTTP认证（例如，OAuth 2.0）
*   **注册中心选择性披露**：注册中心根据客户端的身份和权限返回不同的智能体卡片。

任何包含敏感数据的智能体卡片都必须通过**认证和授权机制**进行保护。A2A规范强烈建议使用**带外动态凭据**，而不是在智能体卡片中嵌入静态密钥。

## 未来考量

A2A社区正在探索标准化注册中心交互或高级发现协议的可能性。

---

### 详细解释

智能体发现是A2A生态系统得以运行的 **“启动引擎”** 。其设计体现了协议在**开放性**与**企业级管控**、**自动化**与**安全性**之间的精巧平衡。

1.  **三种策略：覆盖从开放到私有的全频谱需求**
    *   **知名URI**：借鉴了Web的`.well-known`标准，是构建**开放互联网风格AI服务**的理想方式。任何知道域名的人（或智能体）都可以轻松获取“名片”，这鼓励了服务的公开化和可发现性，促进了开放生态的形成。
    *   **策展注册中心**：这是**企业内网和商业市场**的核心模型。注册中心不仅仅是目录，更是**治理工具**。管理员可以审核、分类、下架服务；客户端可以进行复杂的语义搜索（“找一个能处理德语发票且支持数据隐私协议的智能体”）。这解决了在服务数量庞大时的**可管理性**和**可控发现**问题。
    *   **直接配置**：承认了现实世界存在大量**预先确定、关系固定**的集成场景。在初期部署、测试或高度安全的专有系统中，简单直接的配置往往是最可靠的选择。它放弃了动态发现的灵活性，换取了**绝对的确定性和可控性**。

2.  **智能体卡片：发现的“标的物”与安全边界**
    发现过程的终极目标是获取**可信的智能体卡片**。卡片本身的内容设计（身份、端点、技能、认证要求）已经为安全交互奠定了基础。保护卡片的安全，实质上是保护整个协作链的**第一道关口**。
    *   **分层披露**：一个智能体可能有一份公开的简化卡片（仅包含基本信息），和一份需要认证才能获取的详细卡片（包含内部技能描述、扩展参数）。这种设计允许灵活地控制信息暴露程度。
    *   **凭据与卡片分离**：协议明智地规定**不要在卡片中嵌入静态密钥**。认证凭据（如动态令牌）应通过标准的、安全的HTTP头部（如`Authorization: Bearer <token>`）在每次请求时传递。这避免了卡片泄露导致凭据一并泄露的风险，符合现代API安全最佳实践。

3.  **架构意义：松耦合与动态协作的基础**
    标准化的发现机制，特别是前两种（知名URI和注册中心），使得智能体之间的依赖关系从 **“硬编码”** 变为 **“动态查找”** 。客户端不再需要预先知道所有合作伙伴的具体地址和细节，只需要知道**如何找到它们**（通过域名或注册中心查询）。这极大地提高了系统的**弹性**（某个智能体实例故障或迁移，只需更新其卡片或注册信息）和**可进化性**（新智能体上线后，只需发布卡片即可被潜在合作伙伴发现）。

**总结**，A2A的智能体发现机制提供了一套从开放互联网到封闭企业系统都适用的“寻址方案”。它通过**智能体卡片**这个标准化信息包作为核心媒介，以**知名URI、策展注册中心、直接配置**三种递进式策略满足不同场景的灵活性与控制性需求，并从一开始就将**安全保护**作为设计核心。这确保了A2A生态系统既能像万维网一样开放生长，又能像企业级中间件一样安全可控，为大规模、跨组织的AI智能体协作铺平了道路。
